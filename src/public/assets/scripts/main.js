!function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,function(t){return e[t]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=0)}({0:function(e,t,n){n("WfG0"),e.exports=n("zcrr")},WfG0:function(e,t,n){"use strict";n.r(t);var i=biigle.$require("annotations.components.annotationCanvas"),s=biigle.$require("api.annotations"),r=biigle.$require("annotations.components.annotationsTabPlugins"),a=biigle.$require("messages").handleErrorResponse,o=biigle.$require("annotations.stores.images"),l=biigle.$require("labelTrees.components.labelTrees"),u=biigle.$require("core.mixins.loader"),c=biigle.$require("messages"),d=biigle.$require("core.components.sidebar"),h=biigle.$require("core.components.sidebarTab"),f=biigle.$require("core.components.typeahead"),b=biigle.$require("api.users");r.assistanceRequest={props:{annotations:{type:Array,required:!0},url:{type:String,required:!0}},computed:{selectedAnnotations:function(){return this.annotations.filter((function(e){return e.selected}))},isDisabled:function(){return 1!==this.selectedAnnotations.length},href:function(){return this.url+this.selectedAnnotations[0].id}}};var p={components:{labelTrees:l,typeahead:f},data:{typeaheadTemplate:'<span v-text="item.name"></span><br><small v-text="item.affiliation"></small>',users:[],selectedUser:null,labelTrees:[]},computed:{flatLabels:function(){var e=[];return this.labelTrees.forEach((function(t){Array.prototype.push.apply(e,t.labels)})),e},selectedLabels:function(){return this.flatLabels.filter((function(e){return e.selected}))},hasTooManySelectedLabels:function(){return this.selectedLabels.length>5},receiverId:function(){return this.selectedUser?this.selectedUser.id:""},receiverName:function(){return this.selectedUser?this.selectedUser.name:""}},methods:{close:function(){window.close()},loadUsers:function(){return b.query().then(this.usersLoaded,a)},usersLoaded:function(e){e.data.forEach((function(e){e.name=e.firstname+" "+e.lastname})),Vue.set(this,"users",e.data)},selectUser:function(e){this.selectedUser=e},clearSelectedUser:function(){this.selectedUser=null}},created:function(){var e=this,t=biigle.$require("ananas.oldLabels");if(Array.isArray(t)){var n={};t.forEach((function(e){n[e]=null})),this.flatLabels.forEach((function(e){n.hasOwnProperty(e.id)&&Vue.set(e,"selected",!0)}))}var i=this.loadUsers(),s=biigle.$require("ananas.oldReceiverId");s&&i.then((function(){for(var t=e.users.length-1;t>=0;t--)if(e.users[t].id==s)return void(e.selectedUser=e.users[t])})),this.labelTrees=biigle.$require("ananas.labelTrees")}},g=Vue.resource("api/v1/annotation-assistance-requests{/id}",{},{respond:{method:"PUT",url:"api/v1/annotation-assistance-requests{/token}"}}),m={mixins:[u],components:{sidebar:d,sidebarTab:h,annotationCanvas:i},data:{image:null,annotations:[],annotation:null},methods:{setImageAndAnnotation:function(e){this.image=e,this.annotations.push(this.annotation)},focusAnnotation:function(){this.$refs.canvas.focusAnnotation(this.annotation,!0)},handleLoadingError:function(e){c.danger(e)}},mounted:function(){this.annotation=biigle.$require("ananas.annotation"),this.startLoading(),o.fetchAndDrawImage(this.annotation.image_id).then(this.setImageAndAnnotation).then(this.focusAnnotation).catch(this.handleLoadingError).finally(this.finishLoading)}},L={mixins:[m],data:{pickedLabel:null,responseText:"",closed:!1,errors:[],showMinimap:!0,token:""},computed:{hasPickedLabel:function(){return null!==this.pickedLabel},hasResponseText:function(){return!!this.responseText},hasDisabledControls:function(){return this.closed||this.loading},hasErrors:function(){return this.errors.length>0}},methods:{pickLabel:function(e){this.hasDisabledControls||(this.pickedLabel===e?this.pickedLabel=null:this.pickedLabel=e)},submit:function(){var e={};this.hasPickedLabel&&(e.response_label_id=this.pickedLabel),this.hasResponseText&&(e.response_text=this.responseText),this.startLoading(),g.respond({token:this.token},e).finally(this.clearErrors).then(this.handleSuccess,this.handleError).finally(this.finishLoading)},handleSuccess:function(){this.closed=!0},clearErrors:function(e){return Vue.set(this,"errors",[]),e},handleError:function(e){for(var t in e.body)e.body.hasOwnProperty(t)&&this.errors.push(e.body[t][0])},checkForMobile:function(){window.innerWidth<1e3?this.showMinimap=!1:this.showMinimap=!0}},created:function(){this.checkForMobile(),window.addEventListener("resize",this.checkForMobile),this.token=biigle.$require("ananas.token")}},y={mixins:[m],data:{existingLabels:[],userId:null,suggestedLabelId:null},computed:{attachedSuggestedLabel:function(){for(var e=this.existingLabels,t=e.length-1;t>=0;t--)if(e[t].label_id===this.suggestedLabelId&&e[t].user_id===this.userId)return!0;return!1}},methods:{attach:function(){this.startLoading(),s.attachLabel({id:this.annotation.id},{label_id:this.suggestedLabelId,confidence:1}).then(this.handleAttachSuccess,a).finally(this.finishLoading)},handleAttachSuccess:function(){this.existingLabels.push({label_id:this.suggestedLabelId,user_id:this.userId})}},created:function(){this.existingLabels=biigle.$require("ananas.labels"),this.userId=biigle.$require("ananas.userId"),this.suggestedLabelId=biigle.$require("ananas.suggestedLabelId")}};biigle.$mount("ananas-respond-container",L),biigle.$mount("ananas-show-container",y),biigle.$mount("create-ananas-form",p)},zcrr:function(e,t){}});