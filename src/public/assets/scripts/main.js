biigle.$viewModel("ananas-respond-container",function(e){var n=biigle.$require("api.ananas"),i=biigle.$require("ananas.token");new Vue({el:e,mixins:[biigle.$require("ananas.mixins.ananasContainer")],data:{pickedLabel:null,responseText:"",closed:!1,errors:[],showMinimap:!0},computed:{hasPickedLabel:function(){return null!==this.pickedLabel},hasResponseText:function(){return!!this.responseText},hasDisabledControls:function(){return this.closed||this.loading},hasErrors:function(){return this.errors.length>0}},methods:{pickLabel:function(e){this.hasDisabledControls||(this.pickedLabel===e?this.pickedLabel=null:this.pickedLabel=e)},submit:function(){var e={};this.hasPickedLabel&&(e.response_label_id=this.pickedLabel),this.hasResponseText&&(e.response_text=this.responseText),this.startLoading(),n.respond({token:i},e).finally(this.clearErrors).then(this.handleSuccess,this.handleError).finally(this.finishLoading)},handleSuccess:function(){this.closed=!0},clearErrors:function(e){return Vue.set(this,"errors",[]),e},handleError:function(e){for(var n in e.body)e.body.hasOwnProperty(n)&&this.errors.push(e.body[n][0])},checkForMobile:function(){window.innerWidth<1e3?this.showMinimap=!1:this.showMinimap=!0}},created:function(){this.checkForMobile(),window.addEventListener("resize",this.checkForMobile)}})}),biigle.$viewModel("ananas-show-container",function(e){var n=biigle.$require("ananas.annotation"),i=biigle.$require("ananas.userId"),t=biigle.$require("ananas.suggestedLabelId"),s=biigle.$require("api.annotations"),a=biigle.$require("messages.store");new Vue({el:e,mixins:[biigle.$require("ananas.mixins.ananasContainer")],data:{existingLabels:biigle.$require("ananas.labels")},computed:{attachedSuggestedLabel:function(){for(var e=this.existingLabels,n=e.length-1;n>=0;n--)if(e[n].label_id===t&&e[n].user_id===i)return!0;return!1}},methods:{attach:function(){this.startLoading(),s.attachLabel({id:n.id},{label_id:t,confidence:1}).then(this.handleAttachSuccess,a.handleErrorResponse).finally(this.finishLoading)},handleAttachSuccess:function(){this.existingLabels.push({label_id:t,user_id:i})}}})}),biigle.$viewModel("create-ananas-form",function(e){var n=biigle.$require("api.users"),i=biigle.$require("messages.store");new Vue({el:e,components:{labelTrees:biigle.$require("labelTrees.components.labelTrees"),typeahead:biigle.$require("core.components.typeahead")},data:{labelTrees:biigle.$require("ananas.labelTrees"),typeaheadTemplate:'<span v-text="item.name"></span><br><small v-text="item.affiliation"></small>',users:[],selectedUser:null},computed:{flatLabels:function(){var e=[];return this.labelTrees.forEach(function(n){Array.prototype.push.apply(e,n.labels)}),e},selectedLabels:function(){return this.flatLabels.filter(function(e){return e.selected})},hasTooManySelectedLabels:function(){return this.selectedLabels.length>5},receiverId:function(){return this.selectedUser?this.selectedUser.id:""},receiverName:function(){return this.selectedUser?this.selectedUser.name:""}},methods:{close:function(){window.close()},loadUsers:function(){return n.query().then(this.usersLoaded,i.handleErrorResponse)},usersLoaded:function(e){e.data.forEach(function(e){e.name=e.firstname+" "+e.lastname}),Vue.set(this,"users",e.data)},selectUser:function(e){this.selectedUser=e},clearSelectedUser:function(){this.selectedUser=null}},created:function(){var e=biigle.$require("ananas.oldLabels");if(Array.isArray(e)){var n={};e.forEach(function(e){n[e]=null}),this.flatLabels.forEach(function(e){n.hasOwnProperty(e.id)&&Vue.set(e,"selected",!0)})}var i=this.loadUsers(),t=biigle.$require("ananas.oldReceiverId");t&&i.bind(this).then(function(){for(var e=this.users.length-1;e>=0;e--)if(this.users[e].id==t)return void(this.selectedUser=this.users[e])})}})}),biigle.$require("annotations.components.annotationsTabPlugins").assistanceRequest={props:{annotations:{type:Array,required:!0},url:{type:String,required:!0}},computed:{selectedAnnotations:function(){return this.annotations.filter(function(e){return e.selected})},isDisabled:function(){return 1!==this.selectedAnnotations.length},href:function(){return this.url+this.selectedAnnotations[0].id}}},biigle.$component("ananas.mixins.ananasContainer",{mixins:[biigle.$require("core.mixins.loader")],components:{sidebar:biigle.$require("core.components.sidebar"),sidebarTab:biigle.$require("core.components.sidebarTab"),annotationCanvas:biigle.$require("annotations.components.annotationCanvas")},data:{image:null,annotations:[]},computed:{annotation:function(){return biigle.$require("ananas.annotation")}},methods:{setImageAndAnnotation:function(e){this.image=e,this.annotations.push(this.annotation)},focusAnnotation:function(){this.$refs.canvas.focusAnnotation(this.annotation,!0)},handleLoadingError:function(e){biigle.$require("messages.store").danger(e)}},created:function(){this.startLoading(),biigle.$require("annotations.stores.images").fetchAndDrawImage(this.annotation.image_id).then(this.setImageAndAnnotation).then(this.focusAnnotation).catch(this.handleLoadingError).finally(this.finishLoading)}}),biigle.$declare("api.ananas",Vue.resource("api/v1/annotation-assistance-requests{/id}",{},{respond:{method:"PUT",url:"api/v1/annotation-assistance-requests{/token}"}}));